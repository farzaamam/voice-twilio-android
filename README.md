### Twilio Quickstart for Aloware

This repository contains a modified version of the Twilio Voice Quickstart for Android. The project has been configured and tested to demonstrate the core features required for the Aloware Android Engineer position: making client-to-PSTN calls, receiving incoming calls, and making client-to-client calls.

---

#### Prerequisites

To run this project, you will need the following:

* **A Twilio Account:** A free account is sufficient for this quickstart.
* **A Twilio Phone Number:** A voice-enabled phone number from the Twilio Console.
* **A Twilio TwiML App:** An application configured with a "Voice Request URL" to handle calls.
* **A TwiML Server:** A server to generate Access Tokens and TwiML instructions. The project's serverless function from the official quickstart repository can be used for this.
* **FCM Setup:** A Firebase project configured for Cloud Messaging to handle incoming call notifications.

---

#### Project Setup

1.  **Clone the Repository:**

    ```
    git clone [https://github.com/your-username/aloware-twilio-quickstart.git](https://github.com/your-username/aloware-twilio-quickstart.git)
    cd aloware-twilio-quickstart
    ```

2.  **Configure the Twilio Serverless Functions:** The original Quickstart project includes a `Server` directory. This is where we will set up the backend logic for generating tokens and handling TwiML.

    * First, use the Twilio CLI to log in. This command will prompt you for your Account SID and Auth Token, which you can find on your Twilio Console. After a successful login, the CLI will automatically generate an **API Key** and **API Secret**.

        ```
        twilio login
        ```

    * Next, update the `Server/.env` file. This file holds the environment variables required for your serverless functions to work correctly. You must set the following values:

        * `ACCOUNT_SID`: Your Twilio Account SID.
        * `AUTH_TOKEN`: Your Twilio Auth Token.
        * `API_KEY`: The API Key generated by the Twilio CLI.
        * `API_SECRET`: The API Secret generated by the Twilio CLI.
        * `callerNumber`: Your Twilio phone number, which will be used for outbound calls.

    * Once the `.env` file is configured, deploy the serverless functions. This will provide you with a public server address for your backend endpoints.

        ```
        cd Server
        twilio serverless:deploy
        ```

3.  **Configure Firebase Cloud Messaging (FCM):**

    * Create a Firebase project and add your Android app to it.
    * Download the `google-services.json` file and place it in the `app` directory of this project.
    * In the Twilio Console, go to **Programmable Voice -> Push Credentials** and create a new FCM Push Credential using your Firebase Server Key.

4.  **Configure the Android Application:**

    * After deploying the serverless functions, you will have a public URL for the server. You must use this URL in your app to fetch the actual access token string. This token is then used by both the `VoiceActivity` and `VoiceService` to authenticate with Twilio. The variable you will be updating is the `static final String accessToken` in `VoiceActivity.java`.

    * Build and run the project on a physical Android device or emulator. The app will prompt you for microphone permissions and request an Access Token from your server.

---

#### System Architecture

The quickstart application works by connecting several key components. The Android app acts as the client, but it relies on a serverless backend to authenticate and configure itself with the Twilio platform. All of the call logic is orchestrated through Twilio.

Here is a simplified flow of how the system works for both outgoing and incoming calls.

**Overall System Diagram**
+----------------+      (1) Get Access Token      +----------------+
|  Android App   |------------------------------->| TwiML Server   |
| (Client)       |<-------------------------------| (Serverless)   |
+----------------+      (2) Returns Token         +----------------+
|                                              |
|                                              |
| (3) Use Token to Register                    | (5) TwiML Instructions
| with Twilio & Make Calls                     |
v                                              v
+------------------+     (4) Initiates Call      +------------------+
|                  |<-----------------------------|                  |
|  Twilio Platform |<----------------------------->|  TwiML Server   |
| (Voice SDK)      |----------------------------->|  (Serverless)   |
|                  |----------------------------->|                  |
+------------------+                             +------------------+
|        ^                                       |
|        |                                       |
|  (6) Call Connection                           | (6) Call Connection
v        |                                       v
+------------------+                                +-----------------+
| PSTN (PSTN Call) |<------------------------------->| Other Client    |
+------------------+                                +-----------------+


**Key Steps:**

1.  **App requests Access Token:** The Android app makes an HTTP request to your deployed TwiML Server to get an Access Token.

2.  **Server generates and returns Token:** The server uses your Twilio credentials (Account SID, Auth Token, API Key, API Secret) to generate a secure Access Token. This token contains a Voice Grant that specifies what the client is allowed to do (e.g., make calls, receive calls, etc.). The token is returned to the app.

3.  **App registers with Twilio:** The app uses the Access Token to initialize the Twilio Voice SDK and register the client with the Twilio platform. This is the crucial step that links your app to your Twilio account.

4.  **Initiating an Outgoing Call:** When the user presses the call button, the app tells the Twilio platform to start an outgoing call. Twilio then looks up your TwiML App's URL.

5.  **TwiML Instructions:** Twilio makes a webhook request to your TwiML Server's URL. The server responds with TwiML (Twilio Markup Language) instructions, such as `<Dial>`.

6.  **Call Connection:** Twilio executes the TwiML instructions, connecting the call to a PSTN number or another client device.

---

#### Demonstrating the Required Features

Here is a step-by-step guide to demonstrate the required features for the presentation.

1.  **Make a Client-to-PSTN Call**

    * **Setup:** Complete the basic setup by following steps 1-6 in the original quickstart guide. This includes deploying the serverless functions, creating a TwiML App, and generating an Access Token that you paste into `VoiceActivity.java`. These steps ensure your app can successfully connect to Twilio and make outbound calls.

    * **Server Configuration:** As mentioned in the project setup, you'll need to update the `callerNumber` variable in your server's code with your own Twilio number. This number will be used as the caller ID for the outbound call.

    * **Demonstration:** In the Android app, press the call button to open the dialog. Enter a PSTN number (a standard phone number) and press the call button again. The app will use the Twilio server to initiate a call to that number, with your Twilio number as the caller ID.

2.  **Receive an Incoming Call**

    * **FCM Configuration:** In step 1 of the original documentation, set up your Firebase project and get the `google-services.json` file for your app. **Crucially**, you must also find your Firebase **Server Key** from the Firebase console, as this is needed for the next step.

    * **Create a Push Credential:** Use the Twilio CLI as described in step 7 to create a Push Credential with your FCM Server Key. This links your Firebase project with your Twilio account, allowing Twilio to send push notifications to your app. The command will return a **Push Credential SID** which you'll need.

    * **Generate a New Access Token:** Use the CLI again to generate a new Access Token, this time including the `push-credential-sid` you just received. Update your `VoiceActivity.java` file with this new token and rebuild the app.

    * **Demonstration:** The `Voice.register()` method in your app will now register it for incoming calls. To test, you can use the URL provided in step 8 (`https://my-quickstart-dev.twil.io/place-call?to=alice`) to trigger an incoming call notification to your device. The app should display an incoming call UI.

3.  **Make a Client-to-Client Call**

    * **Setup:** This is a simple extension of the basic setup, demonstrating how Twilio can connect two app users directly. As explained in step 9, you need to run the quickstart app on two different devices. The key is that each device must register with a **different client identity** when generating its Access Token (e.g., `identity=alice` and `identity=bob`).

    * **Demonstration:** On the device for "alice," open the call dialog. Instead of entering a PSTN number, enter the client identity of the other deviceâ€”in this case, "bob." When you press the call button, the TwiML server will direct the call to "bob's" device, and a client-to-client call will be established.

Thank you for the opportunity. I've enjoyed working with the Twilio SDK and exploring its capabilities. I am prepared to present this project and answer any questions you may have about the architecture, implementation details. 
